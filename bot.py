import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.types import WebAppInfo, KeyboardButton, ReplyKeyboardMarkup
from aiogram.filters import CommandStart

# --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
# !!! –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –í–ê–® –¢–û–ö–ï–ù, –ü–û–õ–£–ß–ï–ù–ù–´–ô –û–¢ @BotFather !!!
# –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
BOT_TOKEN = "–í–°–¢–ê–í–¨–¢–ï_–í–ê–®_–¢–û–ö–ï–ù_–°–Æ–î–ê" 

# URL –≤–∞—à–µ–≥–æ WebApp (—Å–∞–π—Ç–∞ –Ω–∞ GitHub Pages)
WEB_APP_URL = "https://loading1234t.github.io/GGbot/"

# --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
# –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

# --- –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–û–ú–ê–ù–î–´ /start ---
@dp.message(CommandStart())
async def command_start_handler(message: types.Message):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É /start. 
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∫–Ω–æ–ø–∫—É, –æ—Ç–∫—Ä—ã–≤–∞—é—â—É—é WebApp.
    """
    
    # 1. –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç WebAppInfo, —É–∫–∞–∑—ã–≤–∞—è URL –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    web_app_info = WebAppInfo(url=WEB_APP_URL)
    
    # 2. –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–∫—Ä–æ–µ—Ç WebApp
    # –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º ReplyKeyboardMarkup, —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –≤–Ω–∏–∑—É, –∫–∞–∫ –≤ –≤–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ.
    web_app_button = KeyboardButton(
        text="üõçÔ∏è –û—Ç–∫—Ä—ã—Ç—å –º–∞—Ä–∫–µ—Ç", 
        web_app=web_app_info
    )
    
    # 3. –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —ç—Ç–æ–π –∫–Ω–æ–ø–∫–æ–π
    keyboard = ReplyKeyboardMarkup(
        keyboard=[[web_app_button]], # –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π –≤ –æ–¥–Ω–æ–º —Ä—è–¥—É
        resize_keyboard=True,         # –°–¥–µ–ª–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∫–æ–º–ø–∞–∫—Ç–Ω–æ–π
        one_time_keyboard=False       # –û—Å—Ç–∞–≤–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –≤–∏–¥–∏–º–æ–π
    )

    # 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
    await message.answer(
        f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ GGPoint –ú–∞—Ä–∫–µ—Ç, {message.from_user.full_name}!\n\n"
        "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '–û—Ç–∫—Ä—ã—Ç—å –º–∞—Ä–∫–µ—Ç' –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø–æ–∫—É–ø–∫–∏ –∏–ª–∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏.",
        reply_markup=keyboard
    )

# --- –ó–ê–ü–£–°–ö –ë–û–¢–ê ---
async def main():
    if BOT_TOKEN == "–í–°–¢–ê–í–¨–¢–ï_–í–ê–®_–¢–û–ö–ï–ù_–°–Æ–î–ê":
        print("!!! –û–®–ò–ë–ö–ê: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–º–µ–Ω–∏—Ç–µ '–í–°–¢–ê–í–¨–¢–ï_–í–ê–®_–¢–û–ö–ï–ù_–°–Æ–î–ê' –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞.")
        return
        
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ. –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.")
    # –ó–∞–ø—É—Å–∫–∞–µ–º –æ–ø—Ä–æ—Å —Å–µ—Ä–≤–µ—Ä–∞ Telegram –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    await dp.start_polling(bot)

if __name__ == "__main__":
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤—Ä—É—á–Ω—É—é.")
    except Exception as e:
        print(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞: {e}")
